\chapter{Incorporar elementos que no son texto}

\begin{intro}
En este capítulo abordaremos cómo incorporar elementos que no forman parte del flujo del texto: imágenes, gráficos y tablas de datos.
\end{intro}

\section{Incorporar imágenes}

Las imágenes que se pueden incluir con \XeLaTeX son
 de formato JPEG (extensión~\ext{jpg}), PNG (extensión~\ext{png}) o PDF (extensión~\ext{pdf}). Es preciso utilizar el package \package{graphicx}.


La incorporación de una imagen se hace así: \csp{includegraphics}\oarg{opciones}\marg{ruta a la imagen}.

La ruta a la imagen se indica de la misma forma que la ruta a los ficheros incluidos\renvoi{chemin}. Las principales opciones, separadas por comas, son las siguientes\footcite[Para las otras, hay que consultar][]{graphicx_options} :

\begin{longtable}{|p{0.2\textwidth}|p{0.45\textwidth}|p{0.2\textwidth}|}
    \hline
    \centering\textbf{Parámetros} & \centering\textbf{Significado} & \centering\textbf{Ejemplo}    \tabularnewline
    \hline
    \endhead
    \hline
    \endfoot
    angle        & Ángulo expresado en grados. Un número positivo indica una rotación contraria a las agujas del reloj, y un número negativo una rotación horaria.     & \verb|angle=90| \\
    height        & Altura    & \verb|height=10cm|     \\
    scale        & Escalado proporcional & \verb|scale=0.5|\\
    width        & Anchura     & \verb|width=10cm|     \\
\end{longtable}


\begin{plusloins}
El centímetro no es la única unidad de medida disponible en \LaTeX. Hablamos de ello en un anexo de este libro\renvoi{unite}.
\end{plusloins}

\begin{plusloins}
El package \package{graphicx} ofrece muchas herramientas para manipular gráficamente contenido textual o no. Consulta el manual\footcite{graphicx}.
\end{plusloins}

\begin{attention}
Por supuesto, es más correcto incluir una leyenda bajo la imagen. Explicamos cómo hacerlo más adelante\renvoi{legende}.
\end{attention}

\section{Incorporar gráficos y esquemas}

Puede que queramos incorporar distintos tipos de gráficos o de esquemas: gráficos estadísticos, árboles genealógicos, \emph{stemma codicum} etc.
Tenemos dos soluciones:
\begin{enumerate}
\item Emplear un programa externo que exporte el gráfico en una imagen que se incluirá como cualquier otra.
\item Emplear las posibilidades \LaTeX y del package\package{TikZ}.\label{TikZ}
\end{enumerate}

La primera solución parece más sencilla a primera vista, ya que no exige el conocimiento de nuevos elementos de \LaTeX. No obstante, con ella tenemos que manejar más ficheros\footnote{Tomemos un gráfico generado mediante una hoja de cálculo: habrá que conservar la hoja de cálculo más la imagen del gráfico generada por ella.}. Además, las imágenes exportadas por estos programas, al ser muy a menudo de tipo bitmap y no vectoriales%
\footnote{Hay dos maneras en informática de codificar una imagen: codificarla punto por punto (imagen en bitmap) o bien codificar sólo las formas, por ejemplo, círculos o segmentos (imagen vectorial). El primer método está pensado para imágenes complejas, como fotografías, mientras que el segundo se recomienda para las imágenes \enquote{simples}, como los gráficos. El sistema vectorial tiene la ventaja de ofrecernos una imagen que se puede escalar con más facilidad, sin pérdida de calidad y de permitir fácilmente la selección de texto.}, perdemos la posibilidad de seleccionar los textos en el PDF que genera \LaTeX, y nos arriesgamos a tener problemas con el escalado.

Vamos a presentarte aquí una de las posibilidades del package \package{TikZ}: la representación de una familia de manuscritos. 

Hemos elegido este ejemplo porque es bastante sencillo, aunque bastante frecuente en humanidades. Pero\package{TikZ} permite hacer muchas más cosas, como producir diagramas estadísticos: remitimos a otras obras para saber más de él\footnote{Además del manual \cite{tikz}, se puede leer \cites{tikzimpatient}[también se puede consultar la página][]{tikzexample}.}.
Este package tiene una sintaxis específica. 

\begin{attention}
   Aunque el package se llama \package{TikZ}, hay que llamarlo en el preámbulo \emph{sin mayúsculas}: \cs{usepackage}\verb+{tikz}+.
 
\end{attention}

Tenemos seis familias de manuscritos de un mismo texto. La familia A ha generado las familias B, C y D. Las familias E y F, por su parte, proceden de la familia D. 

El código es el siguiente: 
\inputminted{exemples/premierpas/nontextuels/genealogie.tex}

Esto da el resultado que aparece en la figura~\ref{figure:genealogie}. Analicemos el código:

\begin{figure}[h]
\centering
\input{exemples/premierpas/nontextuels/genealogie}
\caption{Ejemplo de \emph{stemma}}
\label{figure:genealogie}
\end{figure}



\begin{description}
\item[Línea 1] El entorno \enviro{tikzpicture} es el entorno que se emplea par insertar una figura TikZ. Puede recibir muchos argumentos para modificar algunos aspectos, como la anchura de las líneas por defecto, el tamaño del texto, la orientación del esquema. Remitimos a la documentación.
\item[Línea 2] Un nodo TikZ, para el que se emplea el comando \csp{node}, es un bloque de texto. Se podrían dar opciones a este comando para modificar algunos aspectos como el tamaño del texto.
\item[Líneas 3 y 4] \verb|child| designa aquí una operación: asociar un hijo al nodo anterior. Este hijo es, a su vez, un nodo (\verb|node|).
\item[Líneas 5 a 12]  Lo mismo que antes, salvo que al nodo D se le asignan dos hijos (E y F). Fíjate en el número de llaves y en sus anidamientos: es lo que permite a \package{TikZ} construir correctamente el \emph{stemma}.
\item[Línea 13] El punto y coma es obligatorio después de cada comando \package{TikZ} (aquí \cs{node}).
\item[Línea 14] Fin del gráfico \package{TikZ}.
\end{description}

Está claro que un código así es relativamente complicado. Por ese motivo te aconsejamos comentarlo con atención\footnote{Por motivos de espacio no lo hemos hecho aquí.} y prestar especial atención a las llaves. Por otro lado, recomendamos poner cada gráfico \package{TikZ} en un fichero aparte.


Nuesto \emph{stemma} es relativemente sencillo: no hay contaminación. Si la hubiera habido, la construcción habría sido más compleja: no habríamos podido emplear las operaciones de tipo \verb|child|, o no únicamente, y habríamos tenido que ubicar con precisión los elementos mediante un sistema de coordenadas\footcites[Hemos publicado en nuestra página de Internet una serie de artículos sobre los \emph{stemmata} con TikZ:][]{stemma}[resultará provechosa la lectura de un artículo escrito en la lengua de Dante][]{Leal2012a}.

\begin{plusloins}
El package \package{tikz-qtree}\footcite{tikz-qtree} simplifica la construcción de \emph{stemmata} ya que ofrece una sintaxis simplificada y herramientas para resolver los casos de contaminación.  
\end{plusloins}


\section{Creación de tablas}

\begin{attention}
La creación de tablas en \LaTeX exige un rigor escrupuloso. Es, a nuestro parecer, uno de los elementos más complicados de \LaTeX. Por eso, sólo presentamos aquí un breve esbozo: se pueden encontrar con facilidad ejemplos más detallados en otras obras o en Internet\footcite[Se pueden consultar ficheros bastante didácticos:][]{bebert_tableaux}.
\end{attention}

\subsection{Sintaxis elemental}

La creación de una tabla sencilla se hace por medio del entorno \enviro{tabular}, con la sintaxis siguiente:

\begin{latexcode}
\begin{tabular}{<tipo de columna>}
    Celda & Celda & Celda \\
    Celda & Celda & Celda \\
\end{tabular}
\end{latexcode}

El carácter \verb|&| indica un cambio de celda. El carácter \verb|\\| indica un cambio de línea.

El argumento \arg{tipo de columna} del entorno \enviro{tabular} sirve para indicar:
\begin{enumerate}
    \item El número de celdas.
    \item El formato del texto en el interior de las celdas.
    \item Eventualmente, los separadores verticales de las celdas.
    
\end{enumerate}

Hay tres tipos posibles de columnas que indican la alineación del texto: \label{typecolonnes}

\begin{description}
\item[l] Alineado a la izquierda.
\item[c] Centrado.
\item[r] Alineado a la derecha.
\end{description}

Imaginemos que tenemos una tabla con tres columnas. Deseamos que las celdas de la primera columna estén alineadas a la izquierda, las de la segunda centradas y las de la tercera alineadas a la derecha\footnote{Aquí rompemos el principio de separación entre fondo y forma. Sin embargo, el lector podrá, cuando lo haya asimilado, soslayar fácilmente esta ruptura y volver al camino correcto.}.  
Tenemos que escribir:

\inputminted{exemples/premierpas/nontextuels/tableau3colonnes.tex}


\input{exemples/premierpas/nontextuels/tableau3colonnes}

Por defecto, la tabla tendrá la anchura mínima necesaria para poder verla. 

Se puede emplear el entorno \enviro{tabular*} que ofrece un argumento adicional correspondiente a la anchura total de la tabla:

\begin{latexcode}
\begin{tabular*}{<anchura de la tabla>}{<tipo de columna>}
    Celda & Celda & Celda \\
    Celda & Celda & Celda \\
\end{tabular}
\end{latexcode}

A veces puede resultar práctico indicar el tamaño de las columnas: especialmente, cuando nuestras celdas contienen párrafos.

Para hacerlo, el package \package{array} nos ofrece tres tipos adicionales de columnas\footnote{En realidad, el primer tipo sólo requiere que se cargue el package.}. Esto tipos, a diferencia de los anteriores, establecen una anchura de columna. Para emplearlos, hay que conocer las unidades de medida\renvoi{unite} de \LaTeX. 

Estos tipos de columnas son:
\begin{description}
    \item[p\marg{anchura}] texto justificado. La línea más alta del texto se encuentra en la línea de la base.
    \item[m\marg{anchura}] texto justificado. La línea intermedia del texto se encuentra en la línea de la base.
    \item[b\marg{anchura}] texto justificado. La línea más baja del texto se encuentra en la línea de la base.
\end{description}

La línea de la base es una línea concreta que se corresponde \emph{grosso-modo} al centro de una celda. Ejemplo:

\inputminted{exemples/premierpas/nontextuels/tableau3colonnesarray.tex}
\input{exemples/premierpas/nontextuels/tableau3colonnesarray}



\begin{plusloins}
Puedes crear tus propios tipos de columnas para, por ejemplo, emplearlas con una tipografía determinada. Consulta el manual del package \package{array}\footcite{array_colonnes}.
\end{plusloins}

\begin{plusloins}
Puedes utilizar el package \package{diagbox} para tener una celda dividida en dos en sentido diagonal para las tabblas con entradas dobles.
\end{plusloins}

\begin{plusloins}
El package \package{tabularx} ofrece un entorno \package{tabularx} que permite calcular automáticamente el tamaño de las columnas.
\end{plusloins}

\begin{plusloins}
También existe un package \package{tabbing} que permite realizar alineaciones de texto sin emplear una tabla\footcite{tabbing}.
\end{plusloins}

\begin{plusloins}
Se pueden simular algunas funciones de una hoja de cálculo por medio del package \package{spreadtab}\footcite{spreadtab}.
\end{plusloins}

\subsubsection{Separación de celdas}

Se pueden trazar líneas de separación de celdas: para una línea horizontal, basta con utilizar el comando \csp{hline}. Para una línea vertical, hay que incluir el carácter \verb+|+\footnote{Este carácter, llamado \forme{pleca} no debe confundirse con una L minúscula.} entre los tipos de celdas.

Se pueden trazar líneas horizontales más cortas por medio de \csp{cline}\verb|{<col1>-<col2>}|, donde hay que sustituir \arg{col1} y \arg{col2} por los números de las columnas.

\inputminted{exemples/premierpas/nontextuels/tableauseparateur.tex}
\input{exemples/premierpas/nontextuels/tableauseparateur}

\subsubsection{Combinación de celdas}

Se pueden combinar celdas. Para una combinación de columnas hay que emplear el comando siguiente:
\csp{multicolumn}\marg{numcol}\marg{tipo}\marg{contenido}.

\begin{description}

\item[\arg{numcol}] es el número de columnas que vamos a combinar.
\item[\arg{tipo}] es el tipo de columna resultante, según la sintaxis que hemos visto antes.
\item[\arg{contenido}] es el contenido de la línea combinada.
\end{description}

Para una combinación de líneas, hay que cargar el package \package{multirow}. Éste ofrece un comando \cs{multirow} cuya sintaxis esquemáticamente es la siguiente\footcite[Esquemáticamente, porque no presentamos los argumentos optativos: remitimos a la documentación:][]{multirow} :

\csp{multirow}\marg{líneas}\marg{anchura}\marg{contenido}.


\begin{description}
\item[\arg{líneas}] es el número de líneas afectadas por la combinación.
\item[\arg{anchura}] es la anchura del texto. Se puede escribir \verb|*| para permitir que \LaTeX{} se encarge de eso.
\item[\arg{contenido}] es el contenido de la celda resultante de la combinación.
\end{description}

\inputminted{exemples/premierpas/nontextuels/tableaufusion.tex}
\input{exemples/premierpas/nontextuels/tableaufusion}

Se observará que las celdas vacías se corresponden a las primitivas celdas A2 y A3. El comando \cs{multirow} no modifica la estructura de la tabla: sólo indica que el texto se sitúa en varias columnas.

\subsection{Tablas largas}

Si construyes por este procedimiento una tabla larga, te darás cuenta de que las celdas sobresalen por el margen inferior hasta desbordarse de la página, en vez de, cosa que parecería lógica, continuar en las páginas siguientes.

Para evitar eso, hay que emplear el entorno \enviro{longtable} del package homónimo\index[pkg]{longtable}.

\begin{latexcode}
\usepackage{longtable}
…
\begin{longtable}{tipos de columna}
…
\end{longtable}
\end{latexcode}

La sintaxis de un entorno \enviro{longtable} es idéntica a la de un entorno \enviro{tabular}. Sin embargo, el package ofrece dos comandos adicionales para indicar los encabezados y pies de la tabla y que se repiten en cada página. Estos comandos son, respectivamente, \csp{endhead} y \csp{endfoot}. También hay un comando \csp{endfirsthead} para indicar el encabezado específico de la primera página de la tabla y un comando \csp{endlastfoot} para indicar el pie específico de la última página de la tabla.

Estos cuatro comandos son optativos y deben emplearse al comienzo de la tabla: hay que colocar los elementos correspondientes \emph{antes}  de cada uno de los comandos, de la forma siguiente:

\begin{latexcode}
\begin{longtable}{tipo de columna}
Celdas de encabezado.
\endhead
Celdas de encabezado para la primera página.
\endfirsthead
Celdas de pie.
\endfoot
Celdas de pie para la última página.
\endlastfoot
Celdas del cuerpo de la tabla.
\end{longtable}
\end{latexcode}

\begin{attention}
Con \enviro{longtable}, hay que compilar dos veces el fichero \ext{tex}. 
En efecto, \XeLaTeX{} ---igual que \LaTeX{}--- no puede determinar el tamaño de las columnas en la primera compilación: realiza un cálculo página a página. Sin embargo, almacena el tamaño máximo de las columnas en un fichero temporal que tiene la extensión \ext{aux}. Durante la segunda compilación, utiliza este fichero temporal para indicar el tamaño de las columnas en cada una de las páginas.
\end{attention}
 
\begin{plusloins}
Para presentar un gráfico estadístico, recomendamos el uso del package \package{TikZ}\renvoi{TikZ}. No obstante, el dominio de esta herramienta puede resultar bastante complicado. Por eso recogemos en esta lista algunos packages útiles : 
\begin{itemize}
\item El package \package{csvpie} ofrece una función para trazar un diagrama circulas a partir de un fichero \ext{csv}\footcite[Su documentación se encuentra en la del package \package{csvtools}:][]{csvtools_pie}. 
\item El package \package{datatool} ofrece algunos gráficos estadísticos. Hay que grabar los datos según un sistema vinculado al  package. Remitimos a su documentación\footcite{datatool}.
\end{itemize}
\end{plusloins}


\section[El concepto de flotante]{¿Dónde incorporar los elementos no textuales?  Concepto de flotante}
\label{legende}
Hemos visto cómo incorporar elementos no textuales. Sin embargo, te darás cuenta enseguida de que el formato no es siempre de los mejores, ya que, al incluirse el elemento dentro del texto, en el lugar exacto en el que se le ha llamado, esto puede generar espacios en blanco indeseados. Además, estos elementos no textuales suelen llevar normalmente una leyenda que aún no sabemos como poner.

Para resolver ambos problemas ---ubicación estética y leyenda--- \LaTeX utiliza el concepto de flotante. Un flotante es, por tanto, un elemento no textual que \LaTeX trata de insertar en el mejor sitio, desde el punto de vista de la estética, y que tiene (o puede tener) una leyenda.

Hay dos tipos principales de flotantes:
\begin{itemize}
    \item Las figuras, que se generan con el entorno \enviro{figure}.
    \item Las tablas, que se generan con el entorno \enviro{table}.
\end{itemize}

La sintaxis para incorporar el primer tipo es la siguiente:

\begin{latexcode}
\begin{figure}[<parámetro de ubicación>]
    Inclusión de la figura o de la imagen,
    de acuerdo con los códigos que hemos mostrado antes.
    \caption{<Leyenda>}
\end{figure} 
\end{latexcode}

La que permite incorporar el segundo tipo es la siguiente:

\begin{latexcode}
\begin{table}[<parámetro de ubicación>]
    Inclusión de una tabla, de acuerdo con los códigos que hemos mostrado antes.
    \caption{<Leyenda>}
\end{table} 
\end{latexcode}

Si el comando \cs{caption} se pone encima de la figura, de la imagen o de la tabla, la leyenda aparecerá encima del elemento y no debajo. Se puede, aunque no es recomendable, no poner una leyenda.

Hemos visto un ejemplo de flotante en este capítulo: la figura~\ref{figure:genealogie}.
\begin{attention}
    Podríamos querer cambiar las rúbricas como \emph{figura} y \emph{tabla}. Todo esto es posible: hablaremos de ello más adelante en el apartado dedicado a las cadenas de lengua de  \package{polyglossia}\renvoi{i18npoly}.
    
    También podríamos querer remitir automáticamente al número y a la página de una figura: hablamos de eso en el capítulo dedicado a la navegación por el interior de un documento\renvoi{label}.
\end{attention}

Ten en cuenta que, como los títulos de los apartados, el comando \csp{caption} puede recibir un argumento optativo que se utiliza como título en el índice de figuras o en el índice de tablas\renvoi{tablefigure}: 
\cs{caption}\oarg{Leyenda para la tabla}\marg{Leyenda}. 


\begin{plusloins}

A veces, resulta útil centrar el contenido del flotante. Se trata de una excepción al principio de separación del fondo y la forma. Para realizar este centrado hay que usar el comando \csp{centering}.

\begin{latexcode}
\begin{figure}[<parámetro de ubicación>]
    \centering
    Inclusión de la figura o de la imagen,
    de acuerdo con los códigos que hemos mostrado antes.
    \caption{<Leyenda>}
\end{figure} 
\end{latexcode}


Para personalizar el estilo de la leyenda, el metodo más sencillo consiste en utilizar el package \package{caption}. Remitimos a su documentación\footcite{caption}.

Para utilizar una leyenda fuera de un flotante, se puede usar el package \package{ccaption}\footcite{ccaption}, que permite más cosas todavía.

Si se quieren tener dos elementos flotantes frente a frente, en la página izquierda y en la página derecha, se puede utilizar el \package{dpfloat}\footcite{dpfloat}.

El package \package{endfloat}\footcite{endfloat} permite, por su parte, ubicar sistemáticamente los flotantes al final del trabajo.

Para tener flotantes orientados en sentido distinto al de la página, se empleará el package \package{rotfloat}\footcite{rotfloat}.

Se puede incluir, dentro de una figura, subfiguras, cada una de ellas con su propia leyenda, además de la leyenda principal; ha que utilizar el package\package{subcaption}\footcite{subcaption}.

Por último, se pueden crear otros tipos de flotantes por medio del package \package{float}\footcite{float}.
\end{plusloins}



\subsection{Elegir el emplazamiento del flotante}

El \arg{parámetro de ubicación} indica a \LaTeX cómo situar los elementos flotantes en una posición ideal. Se trata de un parámetro indicativo que el compilador trata de acatar en la medida de sus posibilidades, aunque no es forzoso que lo haga. Los valores son los siguientes:

\begin{longtable}{|l|l|}
    \hline
    \headlongtable{Valor} & \headlongtable{Significado}    \\
    \hline
    \endhead
    \hline
    \endfoot
    h     & En el lugar en que se llama al flotante \\
    t     & En la parte superior de una página                \\
    b     & En la parte inferior de una página               \\
    p     & En una página exclusiva para flotantes        \\
\end{longtable}

Es muy importante comprender que se trata de parámetros indicativos: quieren decir a \LaTeX la posición ideal. Pero \LaTeX utiliza otros parámetros, como el lugar reservado al texto en una página, para ubicar los flotantes. Poner delante de un parámetro \verb+!+ hace que presionemos a \LaTeX en lo que afecta a la colocación.

Se pueden emplear más parámetros. En ese caso, el orden de llamada de los parámetros carecerá de influencia: \LaTeX tratará de ubicar el flotante en función de los parámetros invocados, según el siguiente orden: en el lugar de la llamada, en la parte superior de la página, en la inferior, en una página aparte, después en la parte superior de otra página, luego en la inferior de otra página\footcite[252]{Mittelbach2014}.

El parámetro \verb+h+ significa que se coloca el flotante donde se le llama, si es posible. Puede suceder que resulte imposible. En ese caso, el flotante se ubicará en otro sitio. El package \package{float} ofrece un parámetro \verb+H+, que permite forzar la ubicación en el lugar de la llamada, aunque eso provoque problemas de páginas que queden incompletas. Este parámetro \verb+H+ no puede utilizarse a la vez que otros parámetros\footcite{float_H}.

Aunque, por lo general, el sistema de flotantes permite mantener un diseño de página correcto, sin alejar demasiado el elemento de su ubicación, en ocasiones, la distancia puede resultar demasiado grande.

El comando \csp{FloatBarrier} del package \package{placeins} permite solventar este problema\footcite{placeins}. 
Todos los flotantes invocados antes del comando se ubican antes de él.

\begin{plusloins}
El lector curioso, o que necesite controlar totalmente sus elementos flotantes, puede leer un artículo de Franck~Mittelbach, uno de los desarrolladores de \LaTeX\footcite{Mittelbach2014}. 
\end{plusloins}





    
